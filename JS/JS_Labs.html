<!DOCTYPE html>
<html>
<head>
	<title>Лабы</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="set.css">
</head>
<body>
	<div class="var">
		<p>Вариант 22</p>
	</div>
	<div class="menuall">

		<div>
			<button onclick="toggleContent(1); showDateTime();">Лабораторная 1</button>
			<div class="content" id="content1"></div>
		</div>

		<div>
			<button onclick="toggleContent(2)">Лабораторная 2</button>
			<div class="content" id="content2">
				<table id="calendar">
					<thead>
					<tr><td>‹<td colspan="5"><td>› 
					<tr><td>Пн<td>Вт<td>Ср<td>Чт<td>Пт<td>Сб<td>Вс
					<tbody>
				</table>
			</div>
		</div>

		<div>
			<button onclick="toggleContent(4)">Лабораторная 4</button>
			<div class="content" id="content4">

			</div>
		</div>

		<div>
			<button onclick="toggleContent(7)">Лабораторная 7</button>
			<div class="content" id="content7">
				<div class="menu cand">
					<h3 class="title">СЛАДОСТИ</h3>
					<ul id="list7">
						<li>Печенье</li>
						<li>Шоколад</li>
						<li>Конфета</li>
						<li>Леденец</li>
					</ul>
				<h3 id="end7">СЛАДОСТИ КОНЧИЛИСЬ</h3>
				</div>
			</div>
			<script>
				function remove(link) {
					link.parentNode.parentNode.removeChild(link.parentNode);
				}

				let endtext = document.getElementById("end7");
				endtext.style.visibility = "hidden";
		
				let menuElement = document.querySelector(".cand");
				let titleElement = menuElement.querySelector(".title");
				
				titleElement.onclick = function () {
				  menuElement.classList.toggle("hidden");
				};
		
				document.addEventListener("DOMContentLoaded", function () {
				  const itemsList = document.getElementById("list7");
		
				  itemsList.addEventListener("click", function (event) {
					let target = event.target;
					if (target.tagName === "LI") {
					  target.classList.add("fading");
					  setTimeout(() => {
						target.remove();
					  }, 100);
					}
					
					if (itemsList.childElementCount == 1) {
						setTimeout(()=>{
							endtext.style.visibility = "visible";
							endtext.classList.add("fading_out");
						},120);
					}
				  });
				});
			  </script>
		</div>

		<div>
			<button onclick="toggleContent(8)">Лабораторная 8</button>
			<div class="content" id="content8">
				<div class="task8container">
					<h3 class="task8text">ку)</h3>
					<img class="task8img" id="task8nig" src="img/task8.jpg" alt="niggers" />
				</div>
			</div>
		</div>

		<div>
			<button onclick="toggleContent(11)">Лабораторная 11</button>
			<div class="content" id="content11">
				<canvas id="game" width="608" height="608"></canvas>
			</div>
		</div>

	</div>
	<script>
		function toggleContent(id)
		{
			var content = document.getElementById("content" + id);
			if (content.style.display === "none") {
				content.style.display = "block";
			} else {
				content.style.display = "none";
			}
		}
		
		//Task1
        function showDateTime(){
            let now = new Date();
			//год с незначащими нулями
			let year = now.getFullYear();
			let month = (now.getMonth() + 1).toString().padStart(2, '0');
			let day = now.getDate().toString().padStart(2, '0');
			let daysOfWeek = ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'];
			let day_week = daysOfWeek[now.getDay()];
			let status_date = `${day_week}, ${year}-${day}-${month}`;
			//время с нулями	
			let hours = now.getHours().toString().padStart(2, '0');
			let minutes = now.getMinutes().toString().padStart(2, '0');
			let seconds = now.getSeconds().toString().padStart(2, '0');
			let status_time = `${hours}:${minutes}:${seconds}`;

			let content1 = document.getElementById("content1");
			content1.innerHTML = status_date + ' ' + status_time;
        }

		//Task2
		function Сalendar(id, year, month) 
        {
            var Dlast = new Date(year,month+1,0).getDate(),
                D = new Date(year,month,Dlast),
                DNlast = new Date(D.getFullYear(),D.getMonth(),Dlast).getDay(),
                DNfirst = new Date(D.getFullYear(),D.getMonth(),1).getDay(),
                calendar = '<tr>',
                month=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];
            if (DNfirst != 0) 
            {
                for(var  i = 1; i < DNfirst; i++) 
                    calendar += '<td>';
            } 
            else {
                for(var  i = 0; i < 6; i++) 
                    calendar += '<td>';
            }
            // определим сегодня
            for(var  i = 1; i <= Dlast; i++) 
            {
                if (i == new Date().getDate() && D.getFullYear() == new Date().getFullYear() && D.getMonth() == new Date().getMonth()) {
                        calendar += '<td class="today">' + i;
                } else {
                    calendar += '<td>' + i;
                }
                
                if (new Date(D.getFullYear(),D.getMonth(),i).getDay() == 0) {
                    calendar += '<tr>';
                }
            }
            
            for(var  i = DNlast; i < 7; i++) 
                calendar += '<td>&nbsp;'; //неразрывный пробел. чтоб красиво было где пусто 

            document.querySelector('#'+id+' tbody').innerHTML = calendar;
            document.querySelector('#'+id+' thead td:nth-child(2)').innerHTML = month[D.getMonth()] +' '+ D.getFullYear();
            document.querySelector('#'+id+' thead td:nth-child(2)').dataset.month = D.getMonth();
            document.querySelector('#'+id+' thead td:nth-child(2)').dataset.year = D.getFullYear();

            if (document.querySelectorAll('#'+id+' tbody tr').length < 6) 
            {  
                document.querySelector('#'+id+' tbody').innerHTML += '<tr><td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;<td>&nbsp;';
            }
			
			// переключатель минус месяц
			document.querySelector('#calendar thead tr:nth-child(1) td:nth-child(1)').onclick = function() 
			{
				Сalendar("calendar", document.querySelector('#calendar thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar thead td:nth-child(2)').dataset.month)-1);
			}
			// переключатель плюс месяц
			document.querySelector('#calendar thead tr:nth-child(1) td:nth-child(3)').onclick = function() 
			{
				Сalendar("calendar", document.querySelector('#calendar thead td:nth-child(2)').dataset.year, parseFloat(document.querySelector('#calendar thead td:nth-child(2)').dataset.month)+1);
			}
    	}
        Сalendar("calendar", new Date().getFullYear(), new Date().getMonth());

		//task 4

		//task 7


		//task 8
		function makehover(obj, opacity_new, mult)
		{
			if (obj.style.opacity <= 1 && obj.style.opacity >= 0) {
				opacity_new = opacity_new - 0.1 * mult;
				obj.style.opacity = opacity_new;
				if (obj.style.opacity > 1) {
				obj.style.opacity = 1;
				}
				if (obj.style.opacity < 0) {
				obj.style.opacity = 0;
				}
			}
		}

		nig = document.getElementById("task8nig");
		hoveredall = false;
		let hov, allhov;

		let mult = -1;
		const isHover = (e) => e.parentElement.querySelector(":hover") === e;

		const myDiv = document.getElementById("task8nig");
		document.addEventListener("mousemove", function checkHover() {
		const hovered = isHover(myDiv);
		if (hovered !== checkHover.hovered) {
			if (hovered) {
			clearInterval(allhov);
			mult = +1;
			hov = setInterval(function () {
				makehover(myDiv, myDiv.style.opacity, mult);
			}, 50);
			} else {
			mult = -1;
			clearInterval(hov);
			allhov = setInterval(function () {
				makehover(myDiv, myDiv.style.opacity, mult);
			}, 50);
			}
			checkHover.hovered = hovered;
			hoveredall = hovered;
		}
		});

		//task 11
		const canvas = document.getElementById("game");
		const ctx = canvas.getContext("2d");

		const ground = new Image();
		ground.src = "img/ground.png";

		const foodImg = new Image();
		foodImg.src = "img/food.png";

		let box = 32;

		let score = 0;

		let food = {
			x: Math.floor((Math.random() * 17 + 1)) * box,
			y: Math.floor((Math.random() * 15 + 3)) * box,
		};

		let snake = [];

		snake[0] = {
			x: 9 * box,
			y: 10 * box
		};

		document.addEventListener("keydown", direction);

		let dir;

		function direction(event) {
			if(event.keyCode == 37 && dir != "right")
				dir = "left";
			else if(event.keyCode == 38 && dir != "down")
				dir = "up";
			else if(event.keyCode == 39 && dir != "left")
				dir = "right";
			else if(event.keyCode == 40 && dir != "up")
				dir = "down";
			}

			function eatTail(head, arr) 
			{
				for(let i = 0; i < arr.length; i++) 
				{
					if(head.x == arr[i].x && head.y == arr[i].y)
					clearInterval(game);
				}
			}

		function drawGame() {
			ctx.drawImage(ground, 0, 0);

			ctx.drawImage(foodImg, food.x, food.y);

			for(let i = 0; i < snake.length; i++) 
			{
				ctx.fillStyle = i == 0 ? "green" : "red";
				ctx.fillRect(snake[i].x, snake[i].y, box, box);
			}

			ctx.fillStyle = "white";
			ctx.font = "50px Arial";
			ctx.fillText(score, box * 2.5, box * 1.7);

			let snakeX = snake[0].x;
			let snakeY = snake[0].y;

			if(snakeX == food.x && snakeY == food.y)
			{
				score++;
				food = {
					x: Math.floor((Math.random() * 17 + 1)) * box,
					y: Math.floor((Math.random() * 15 + 3)) * box,
				};
			} else {
				snake.pop();
			}

			if(snakeX < box || snakeX > box * 17 || snakeY < 3 * box || snakeY > box * 17)
			{
				restartGame();
			}

			if(dir == "left") snakeX -= box;
			if(dir == "right") snakeX += box;
			if(dir == "up") snakeY -= box;
			if(dir == "down") snakeY += box;

			let newHead = {
				x: snakeX,
				y: snakeY
			};
			
			//проверим пересекается ли новая голова с хвостом чтобы ниче не сломалось
			eatTail(newHead, snake);

			snake.unshift(newHead);
			
			function restartGame() 
			{			
				snake.splice(0, snake.length);
				score = 0;

				food.x = Math.floor((Math.random() * 17 + 1)) * box;
				food.y = Math.floor((Math.random() * 15 + 3)) * box;
				
				snake[0] = {
					x: 9 * box,
					y: 10 * box
				};

				snakeX = snake[0].x;
				snakeY = snake[0].y;

				
				newHead = {
					x: snakeX,
					y: snakeY
				};
				setInterval(game);
			}
		}
		let game = setInterval(drawGame, 100);
	</script>
</body>
</html>